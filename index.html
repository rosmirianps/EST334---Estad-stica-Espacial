<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EST334 - Estad√≠stica Espacial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: linear-gradient(90deg, #ff6b6b, #f06595, #cc5de8, #845ef7, #5c7cfa, #339af0, #22b8cf, #20c997, #51cf66, #94d82d, #fcc419, #ff922b);
            padding: 3px;
            margin-bottom: 30px;
            border-radius: 15px;
        }

        .header-content {
            background: white;
            padding: 30px;
            border-radius: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            width: 80px;
            height: 80px;
        }

        .header-info {
            text-align: center;
            flex: 1;
        }

        .header-info h1 {
            color: #2c3e50;
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header-info h2 {
            color: #7f8c8d;
            font-size: 24px;
            font-weight: normal;
        }

        .course-details {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .detail-badge {
            background: #ecf0f1;
            padding: 12px 24px;
            border-radius: 30px;
            color: #2c3e50;
            font-size: 14px;
        }

        .student-info {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .student-info h2 {
            color: #2980b9;
            font-size: 32px;
            margin-bottom: 15px;
        }

        .student-info p {
            color: #7f8c8d;
            font-size: 16px;
            margin: 8px 0;
        }

        .main-units {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .unit-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .unit-card:hover {
            transform: translateY(-5px);
        }

        .unit-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .unit-card h3 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 15px;
            text-align: center;
        }

        .unit-card p {
            color: #7f8c8d;
            font-size: 16px;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px 35px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .btn-red {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-red:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: scale(1.05);
        }

        .btn-green {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-green:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: scale(1.05);
        }

        .btn-blue {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .btn-blue:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
            transform: scale(1.05);
        }

        .sub-modules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .module-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }

        .module-card:hover {
            transform: translateY(-3px);
        }

        .module-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
        }

        .module-card h4 {
            color: #2c3e50;
            font-size: 22px;
            margin-bottom: 12px;
            text-align: center;
        }

        .module-card p {
            color: #7f8c8d;
            font-size: 14px;
            text-align: center;
            line-height: 1.5;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .back-btn {
            background: white;
            color: #667eea;
            padding: 12px 25px;
            border-radius: 25px;
            border: 2px solid #667eea;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
        }

        .content-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .content-container h2 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 25px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .upload-zone:hover {
            background: #e9ecef;
            border-color: #5568d3;
        }

        .upload-zone.dragover {
            background: #d4d9ff;
            border-color: #5568d3;
        }

        .upload-icon {
            font-size: 50px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-view {
            background: #3498db;
            color: white;
        }

        .btn-view:hover {
            background: #2980b9;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .visualization-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            min-height: 400px;
        }

        .map-container {
            width: 100%;
            height: 500px;
            background: #ecf0f1;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .analysis-tools {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 12px 25px;
            border-radius: 25px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background: #667eea;
            color: white;
        }

        .tool-btn.active {
            background: #667eea;
            color: white;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .data-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .point {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .point:hover {
            width: 15px;
            height: 15px;
            background: #c0392b;
        }

        .heatmap-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <svg class="logo" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="#667eea"/>
                <text x="50" y="65" font-size="40" fill="white" text-anchor="middle" font-weight="bold">UN</text>
            </svg>
            
            <div class="header-info">
                <h1>EST334</h1>
                <h2>Estad√≠stica Espacial</h2>
                <div class="course-details">
                    <div class="detail-badge">üë®‚Äçüè´ Docente: Ing. Fred Torres Cruz</div>
                    <div class="detail-badge">üìÖ Semestre: 2025-II</div>
                    <div class="detail-badge">üóìÔ∏è A√±o: 2025</div>
                    <div class="detail-badge">üìö Cr√©ditos: 4</div>
                </div>
            </div>

            <svg class="logo" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="#764ba2"/>
                <text x="50" y="40" font-size="25" fill="white" text-anchor="middle" font-weight="bold">FIN</text>
                <text x="50" y="65" font-size="25" fill="white" text-anchor="middle" font-weight="bold">ESI</text>
            </svg>
        </div>
    </div>

    <div id="home-section" class="content-section active">
        <div class="student-info">
            <h2>Estudiante: Wilmer Ticona Incacutipa</h2>
            <p>C√≥digo: 213990 ‚Ä¢ Escuela Profesional De Ingenier√≠a Estad√≠stica e Inform√°tica</p>
            <p>Universidad Nacional del Altiplano - Puno</p>
        </div>

        <div class="main-units">
            <div class="unit-card" onclick="showSection('unidad1')">
                <div class="unit-icon">üó∫Ô∏è</div>
                <h3>Unidad I</h3>
                <p>Trabajos desarrollados por mi persona con habilidades para identificar y analizar patrones espaciales en conjuntos de datos georeferenciados.</p>
                <button class="btn btn-red">‚ûú Ingresar</button>
            </div>

            <div class="unit-card" onclick="showSection('unidad2')">
                <div class="unit-icon">üìä</div>
                <h3>Unidad II</h3>
                <p>Aplicar m√©todos geoestad√≠sticos para modelar la variabilidad espacial y temporal de fen√≥menos naturales.</p>
                <button class="btn btn-green">‚ûú Ingresar</button>
            </div>
        </div>

        <div class="sub-modules">
            <div class="module-card" onclick="showSection('analisis')">
                <div class="module-icon">üó∫Ô∏è</div>
                <h4>An√°lisis Espacial</h4>
                <p>Desarrollar habilidades para identificar y analizar patrones espaciales en conjuntos de datos georeferenciados.</p>
            </div>

            <div class="module-card" onclick="showSection('geoestadistica')">
                <div class="module-icon">üìà</div>
                <h4>Geoestad√≠stica</h4>
                <p>Aplicar m√©todos geoestad√≠sticos para modelar la variabilidad espacial y temporal de fen√≥menos naturales.</p>
            </div>

            <div class="module-card" onclick="showSection('interpolacion')">
                <div class="module-icon">üî∑</div>
                <h4>Interpolaci√≥n</h4>
                <p>Implementar t√©cnicas de interpolaci√≥n espacial como Kriging para estimar valores en ubicaciones no muestreadas.</p>
            </div>

            <div class="module-card" onclick="showSection('herramientas')">
                <div class="module-icon">üíª</div>
                <h4>Herramientas</h4>
                <p>Dominar el uso de R, Python y SIG para el procesamiento y an√°lisis de datos espaciales.</p>
            </div>
        </div>
    </div>

    <div id="unidad1" class="content-section">
        <button class="back-btn" onclick="showSection('home-section')">‚Üê Volver</button>
        <div class="content-container">
            <h2>üó∫Ô∏è Unidad I - An√°lisis Espacial</h2>
            
            <div class="upload-zone" onclick="document.getElementById('file-input-u1').click()" ondrop="handleDrop(event, 'unidad1')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-icon">üìÅ</div>
                <h3>Arrastra archivos aqu√≠ o haz clic para seleccionar</h3>
                <p>Soporta: CSV, Excel, Shapefiles, GeoJSON, KML</p>
                <input type="file" id="file-input-u1" class="file-input" multiple onchange="handleFileSelect(event, 'unidad1')" accept=".csv,.xlsx,.xls,.shp,.geojson,.kml">
            </div>

            <div id="files-u1" class="file-list"></div>

            <div class="analysis-tools">
                <button class="tool-btn" onclick="analyzeData('unidad1', 'mapa')">üó∫Ô∏è Visualizar Mapa</button>
                <button class="tool-btn" onclick="analyzeData('unidad1', 'patrones')">üîç Detectar Patrones</button>
                <button class="tool-btn" onclick="analyzeData('unidad1', 'cluster')">‚ö° An√°lisis de Clusters</button>
                <button class="tool-btn" onclick="analyzeData('unidad1', 'autocorr')">üìä Autocorrelaci√≥n Espacial</button>
            </div>

            <div id="viz-u1" class="visualization-area">
                <h3>√Årea de Visualizaci√≥n</h3>
                <p>Carga datos para comenzar el an√°lisis espacial</p>
            </div>
        </div>
    </div>

    <div id="unidad2" class="content-section">
        <button class="back-btn" onclick="showSection('home-section')">‚Üê Volver</button>
        <div class="content-container">
            <h2>üìä Unidad II - Geoestad√≠stica</h2>
            
            <div class="upload-zone" onclick="document.getElementById('file-input-u2').click()" ondrop="handleDrop(event, 'unidad2')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-icon">üìÅ</div>
                <h3>Arrastra archivos aqu√≠ o haz clic para seleccionar</h3>
                <p>Soporta: CSV, Excel, datos de campo</p>
                <input type="file" id="file-input-u2" class="file-input" multiple onchange="handleFileSelect(event, 'unidad2')" accept=".csv,.xlsx,.xls">
            </div>

            <div id="files-u2" class="file-list"></div>

            <div class="analysis-tools">
                <button class="tool-btn" onclick="analyzeData('unidad2', 'variograma')">üìâ Variograma</button>
                <button class="tool-btn" onclick="analyzeData('unidad2', 'kriging')">üéØ Kriging</button>
                <button class="tool-btn" onclick="analyzeData('unidad2', 'temporal')">‚è±Ô∏è An√°lisis Temporal</button>
                <button class="tool-btn" onclick="analyzeData('unidad2', 'validacion')">‚úì Validaci√≥n Cruzada</button>
            </div>

            <div id="viz-u2" class="visualization-area">
                <h3>√Årea de Visualizaci√≥n</h3>
                <p>Carga datos para comenzar el an√°lisis geoestad√≠stico</p>
            </div>
        </div>
    </div>

    <div id="analisis" class="content-section">
        <button class="back-btn" onclick="showSection('home-section')">‚Üê Volver</button>
        <div class="content-container">
            <h2>üó∫Ô∏è An√°lisis Espacial</h2>
            
            <div class="upload-zone" onclick="document.getElementById('file-input-analisis').click()" ondrop="handleDrop(event, 'analisis')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-icon">üìÅ</div>
                <h3>Sube tus datos georeferenciados</h3>
                <p>Formatos: CSV (con coordenadas), Shapefile, GeoJSON</p>
                <input type="file" id="file-input-analisis" class="file-input" multiple onchange="handleFileSelect(event, 'analisis')" accept=".csv,.shp,.geojson">
            </div>

            <div id="files-analisis" class="file-list"></div>

            <div class="analysis-tools">
                <button class="tool-btn" onclick="analyzeData('analisis', 'hotspot')">üî• Hot Spot Analysis</button>
                <button class="tool-btn" onclick="analyzeData('analisis', 'densidad')">üéØ Mapa de Densidad</button>
                <button class="tool-btn" onclick="analyzeData('analisis', 'buffer')">‚≠ï An√°lisis de Buffer</button>
            </div>

            <div id="viz-analisis" class="visualization-area"></div>
        </div>
    </div>

    <div id="geoestadistica" class="content-section">
        <button class="back-btn" onclick="showSection('home-section')">‚Üê Volver</button>
        <div class="content-container">
            <h2>üìà Geoestad√≠stica</h2>
            
            <div class="upload-zone" onclick="document.getElementById('file-input-geo').click()" ondrop="handleDrop(event, 'geoestadistica')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-icon">üìÅ</div>
                <h3>Sube datos de muestreo espacial</h3>
                <p>Incluye coordenadas X, Y y variable de inter√©s</p>
                <input type="file" id="file-input-geo" class="file-input" multiple onchange="handleFileSelect(event, 'geoestadistica')" accept=".csv,.xlsx">
            </div>

            <div id="files-geoestadistica" class="file-list"></div>

            <div class="analysis-tools">
                <button class="tool-btn" onclick="analyzeData('geoestadistica', 'semivariograma')">üìä Semivariograma</button>
                <button class="tool-btn" onclick="analyzeData('geoestadistica', 'modelo')">üî¨ Ajuste de Modelo</button>
                <button class="tool-btn" onclick="analyzeData('geoestadistica', 'prediccion')">üéØ Predicci√≥n Espacial</button>
            </div>

            <div id="viz-geoestadistica" class="visualization-area"></div>
        </div>
    </div>

    <div id="interpolacion" class="content-section">
        <button class="back-btn" onclick="showSection('home-section')">‚Üê Volver</button>
        <div class="content-container">
            <h2>üî∑ Interpolaci√≥n Espacial</h2>
            
            <div class="upload-zone" onclick="document.getElementById('file-input-interp').click()" ondrop="handleDrop(event, 'interpolacion')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-icon">üìÅ</div>
                <h3>Sube puntos de muestreo</h3>
                <p>Datos con coordenadas para interpolaci√≥n</p>
                <input type="file" id="file-input-interp" class="file-input" multiple onchange="handleFileSelect(event, 'interpolacion')" accept=".csv,.xlsx">
            </div>

            <div id="files-interpolacion" class="file-list"></div>

            <div class="analysis-tools">
                <button class="tool-btn" onclick="analyzeData('interpolacion', 'idw')">üìç IDW</button>
                <button class="tool-btn" onclick="analyzeData('interpolacion', 'kriging-ord')">üéØ Kriging Ordinario</button>
                <button class="tool-btn" onclick="analyzeData('interpolacion', 'kriging-uni')">üåê Kriging Universal</button>
                <button class="tool-btn" onclick="analyzeData('interpolacion', 'spline')">„Ä∞Ô∏è Spline</button>
            </div>

            <div id="viz-interpolacion" class="visualization-area"></div>
        </div>
    </div>

    <div id="herramientas" class="content-section">
        <button class="back-btn" onclick="showSection('home-section')">‚Üê Volver</button>
        <div class="content-container">
            <h2>üíª Herramientas de An√°lisis</h2>
            
            <div class="upload-zone" onclick="document.getElementById('file-input-tools').click()" ondrop="handleDrop(event, 'herramientas')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-icon">üìÅ</div>
                <h3>Sube scripts o datos para procesar</h3>
                <p>R, Python, archivos de datos espaciales</p>
                <input type="file" id="file-input-tools" class="file-input" multiple onchange="handleFileSelect(event, 'herramientas')" accept=".r,.py,.csv,.xlsx,.shp,.geojson">
            </div>

            <div id="files-herramientas" class="file-list"></div>

            <div class="analysis-tools">
                <button class="tool-btn" onclick="analyzeData('herramientas', 'r-script')">üìò Ejecutar R</button>
                <button class="tool-btn" onclick="analyzeData('herramientas', 'python')">üêç Ejecutar Python</button>
                <button class="tool-btn" onclick="analyzeData('herramientas', 'qgis')">üó∫Ô∏è Exportar a QGIS</button>
                <button class="tool-btn" onclick="analyzeData('herramientas', 'arcgis')">üåç Exportar a ArcGIS</button>
            </div>

            <div id="viz-herramientas" class="visualization-area"></div>
        </div>
    </div>

    <script>
        const filesData = {
            'unidad1': [],
            'unidad2': [],
            'analisis': [],
            'geoestadistica': [],
            'interpolacion': [],
            'herramientas': []
        };

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, section) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            processFiles(files, section);
        }

        function handleFileSelect(e, section) {
            const files = e.target.files;
            processFiles(files, section);
        }

        function processFiles(files, section) {
            const fileList = document.getElementById(`files-${section}`);
            
            Array.from(files).forEach(file => {
                const fileId = Date.now() + Math.random();
                filesData[section].push({
                    id: fileId,
                    name: file.name,
                    size: file.size,
                    file: file
                });

                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <span class="file-name">üìÑ ${file.name}</span>
                        <span style="color: #7f8c8d; font-size: 12px; margin-left: 10px;">${formatFileSize(file.size)}</span>
                    </div>
                    <div class="file-actions">
                        <button class="btn-small btn-view" onclick="viewFile('${fileId}', '${section}')">üëÅÔ∏è Ver</button>
                        <button class="btn-small btn-delete" onclick="deleteFile('${fileId}', '${section}')">üóëÔ∏è Eliminar</button>
                    </div>
                `;
                fileList.appendChild(fileItem);
            });

            if (filesData[section].length > 0) {
                document.getElementById(`viz-${section}`).innerHTML = `
                    <h3>‚úÖ Archivos cargados correctamente</h3>
                    <p>Usa las herramientas de an√°lisis para visualizar y procesar los datos</p>
                `;
            }
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        function deleteFile(fileId, section) {
            filesData[section] = filesData[section].filter(f => f.id != fileId);
            updateFileList(section);
        }

        function updateFileList(section) {
            const fileList = document.getElementById(`files-${section}`);
            fileList.innerHTML = '';
            
            filesData[section].forEach(fileData => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <span class="file-name">üìÑ ${fileData.name}</span>
                        <span style="color: #7f8c8d; font-size: 12px; margin-left: 10px;">${formatFileSize(fileData.size)}</span>
                    </div>
                    <div class="file-actions">
                        <button class="btn-small btn-view" onclick="viewFile('${fileData.id}', '${section}')">üëÅÔ∏è Ver</button>
                        <button class="btn-small btn-delete" onclick="deleteFile('${fileData.id}', '${section}')">üóëÔ∏è Eliminar</button>
                    </div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function viewFile(fileId, section) {
            const fileData = filesData[section].find(f => f.id == fileId);
            if (!fileData) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const vizArea = document.getElementById(`viz-${section}`);
                
                if (fileData.name.endsWith('.csv')) {
                    displayCSVData(content, vizArea, fileData.name);
                } else if (fileData.name.endsWith('.json') || fileData.name.endsWith('.geojson')) {
                    displayJSONData(content, vizArea, fileData.name);
                } else {
                    vizArea.innerHTML = `
                        <h3>üìÑ ${fileData.name}</h3>
                        <p>Archivo cargado correctamente. Usa las herramientas de an√°lisis para procesarlo.</p>
                    `;
                }
            };
            reader.readAsText(fileData.file);
        }

        function displayCSVData(content, vizArea, filename) {
            const lines = content.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',').map(h => h.trim());
            const rows = lines.slice(1, Math.min(11, lines.length));

            let tableHTML = `
                <h3>üìä Vista previa: ${filename}</h3>
                <p style="color: #7f8c8d; margin-bottom: 15px;">Mostrando ${rows.length} de ${lines.length - 1} filas</p>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
                        </thead>
                        <tbody>
            `;

            rows.forEach(row => {
                const cells = row.split(',').map(c => c.trim());
                tableHTML += `<tr>${cells.map(c => `<td>${c}</td>`).join('')}</tr>`;
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
                
                <div class="stats-grid" style="margin-top: 30px;">
                    <div class="stat-card">
                        <div class="stat-value">${headers.length}</div>
                        <div class="stat-label">Columnas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${lines.length - 1}</div>
                        <div class="stat-label">Filas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${(content.length / 1024).toFixed(2)} KB</div>
                        <div class="stat-label">Tama√±o</div>
                    </div>
                </div>
            `;

            vizArea.innerHTML = tableHTML;
        }

        function displayJSONData(content, vizArea, filename) {
            try {
                const data = JSON.parse(content);
                vizArea.innerHTML = `
                    <h3>üó∫Ô∏è Datos GeoJSON: ${filename}</h3>
                    <pre style="background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 10px; overflow-x: auto; max-height: 400px;">${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (e) {
                vizArea.innerHTML = `
                    <h3>‚ö†Ô∏è Error al leer archivo JSON</h3>
                    <p>El archivo no parece ser un JSON v√°lido.</p>
                `;
            }
        }

        function analyzeData(section, analysisType) {
            const vizArea = document.getElementById(`viz-${section}`);
            
            if (filesData[section].length === 0) {
                vizArea.innerHTML = `
                    <h3>‚ö†Ô∏è No hay datos cargados</h3>
                    <p>Por favor, sube archivos antes de realizar el an√°lisis.</p>
                `;
                return;
            }

            document.querySelectorAll(`#${section} .tool-btn`).forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            switch(analysisType) {
                case 'mapa':
                    showMapVisualization(vizArea);
                    break;
                case 'patrones':
                    showPatternAnalysis(vizArea);
                    break;
                case 'cluster':
                    showClusterAnalysis(vizArea);
                    break;
                case 'autocorr':
                    showAutocorrelation(vizArea);
                    break;
                case 'variograma':
                    showVariogram(vizArea);
                    break;
                case 'kriging':
                    showKriging(vizArea);
                    break;
                case 'temporal':
                    showTemporalAnalysis(vizArea);
                    break;
                case 'validacion':
                    showValidation(vizArea);
                    break;
                case 'hotspot':
                    showHotspotAnalysis(vizArea);
                    break;
                case 'densidad':
                    showDensityMap(vizArea);
                    break;
                case 'buffer':
                    showBufferAnalysis(vizArea);
                    break;
                case 'semivariograma':
                    showSemivariogram(vizArea);
                    break;
                case 'modelo':
                    showModelFitting(vizArea);
                    break;
                case 'prediccion':
                    showPrediction(vizArea);
                    break;
                case 'idw':
                    showIDW(vizArea);
                    break;
                case 'kriging-ord':
                    showOrdinaryKriging(vizArea);
                    break;
                case 'kriging-uni':
                    showUniversalKriging(vizArea);
                    break;
                case 'spline':
                    showSpline(vizArea);
                    break;
                case 'r-script':
                    showRExecution(vizArea);
                    break;
                case 'python':
                    showPythonExecution(vizArea);
                    break;
                case 'qgis':
                    showQGISExport(vizArea);
                    break;
                case 'arcgis':
                    showArcGISExport(vizArea);
                    break;
            }
        }

        function showMapVisualization(vizArea) {
            const points = generateRandomPoints(50);
            
            vizArea.innerHTML = `
                <h3>üó∫Ô∏è Visualizaci√≥n de Mapa Espacial</h3>
                <div class="map-container" id="map-view">
                    <canvas id="map-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value">${points.length}</div>
                        <div class="stat-label">Puntos Analizados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3.45 km</div>
                        <div class="stat-label">Distancia Media</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.78</div>
                        <div class="stat-label">√çndice Espacial</div>
                    </div>
                </div>
            `;

            drawMapPoints(points);
        }

        function generateRandomPoints(count) {
            const points = [];
            for (let i = 0; i < count; i++) {
                points.push({
                    x: Math.random() * 700 + 50,
                    y: Math.random() * 400 + 50,
                    value: Math.random() * 100
                });
            }
            return points;
        }

        function drawMapPoints(points) {
            const canvas = document.getElementById('map-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Background
            ctx.fillStyle = '#ecf0f1';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Grid
            ctx.strokeStyle = '#bdc3c7';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // Points
            points.forEach(point => {
                const radius = 3 + (point.value / 100) * 7;
                const intensity = point.value / 100;
                
                ctx.fillStyle = `rgba(231, 76, 60, ${0.3 + intensity * 0.7})`;
                ctx.beginPath();
                ctx.arc(point.x, point.y, radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
        }

        function showPatternAnalysis(vizArea) {
            vizArea.innerHTML = `
                <h3>üîç An√°lisis de Patrones Espaciales</h3>
                <div class="chart-container">
                    <canvas id="pattern-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">7</div>
                        <div class="stat-label">Hot Spots</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">4</div>
                        <div class="stat-label">Cold Spots</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">99%</div>
                        <div class="stat-label">Confianza</div>
                    </div>
                </div>
            `;
            drawHotspots();
        }

        function drawHotspots() {
            const canvas = document.getElementById('hotspot-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Hot spots (red)
            const hotspots = [
                {x: 200, y: 150}, {x: 250, y: 180}, {x: 180, y: 200},
                {x: 600, y: 300}, {x: 650, y: 320}, {x: 580, y: 350}
            ];
            
            hotspots.forEach(spot => {
                const gradient = ctx.createRadialGradient(spot.x, spot.y, 0, spot.x, spot.y, 60);
                gradient.addColorStop(0, 'rgba(231, 76, 60, 0.8)');
                gradient.addColorStop(1, 'rgba(231, 76, 60, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(spot.x - 60, spot.y - 60, 120, 120);
            });
            
            // Cold spots (blue)
            const coldspots = [
                {x: 400, y: 100}, {x: 450, y: 130},
                {x: 150, y: 400}, {x: 700, y: 150}
            ];
            
            coldspots.forEach(spot => {
                const gradient = ctx.createRadialGradient(spot.x, spot.y, 0, spot.x, spot.y, 50);
                gradient.addColorStop(0, 'rgba(52, 152, 219, 0.8)');
                gradient.addColorStop(1, 'rgba(52, 152, 219, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(spot.x - 50, spot.y - 50, 100, 100);
            });
        }

        function showDensityMap(vizArea) {
            vizArea.innerHTML = `
                <h3>üéØ Mapa de Densidad Kernel</h3>
                <div class="map-container">
                    <canvas id="density-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">250m</div>
                        <div class="stat-label">Radio B√∫squeda</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">Alta</div>
                        <div class="stat-label">Concentraci√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Zonas Densas</div>
                    </div>
                </div>
            `;
            drawDensityMap();
        }

        function drawDensityMap() {
            const canvas = document.getElementById('density-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Create density gradient
            for (let y = 0; y < canvas.height; y += 5) {
                for (let x = 0; x < canvas.width; x += 5) {
                    const density = Math.sin(x * 0.015) * Math.cos(y * 0.02) * 0.5 + 
                                  Math.sin(x * 0.008) * Math.sin(y * 0.012) * 0.5;
                    
                    const value = (density + 1) / 2;
                    const r = Math.floor(255 * (1 - value));
                    const g = Math.floor(255 * 0.5);
                    const b = Math.floor(255 * value);
                    
                    ctx.fillStyle = `rgba(${r}, ${g}, ${b}, 0.6)`;
                    ctx.fillRect(x, y, 5, 5);
                }
            }
        }

        function showBufferAnalysis(vizArea) {
            vizArea.innerHTML = `
                <h3>‚≠ï An√°lisis de Buffer Espacial</h3>
                <div class="map-container">
                    <canvas id="buffer-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">500m</div>
                        <div class="stat-label">Radio Buffer</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">85</div>
                        <div class="stat-label">Puntos Incluidos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">5.2 km¬≤</div>
                        <div class="stat-label">√Årea Total</div>
                    </div>
                </div>
            `;
            drawBuffers();
        }

        function drawBuffers() {
            const canvas = document.getElementById('buffer-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ecf0f1';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const centers = [
                {x: 250, y: 250, r: 80},
                {x: 550, y: 200, r: 100},
                {x: 400, y: 350, r: 90}
            ];
            
            centers.forEach(center => {
                // Outer buffer
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.arc(center.x, center.y, center.r, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Fill
                ctx.fillStyle = 'rgba(52, 152, 219, 0.2)';
                ctx.beginPath();
                ctx.arc(center.x, center.y, center.r, 0, Math.PI * 2);
                ctx.fill();
                
                // Center point
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(center.x, center.y, 6, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function showSemivariogram(vizArea) {
            vizArea.innerHTML = `
                <h3>üìä Semivariograma Experimental</h3>
                <div class="chart-container">
                    <canvas id="semi-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">Esf√©rico</div>
                        <div class="stat-label">Modelo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.95</div>
                        <div class="stat-label">R¬≤ Ajuste</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">15</div>
                        <div class="stat-label">Lags</div>
                    </div>
                </div>
            `;
            drawSemivariogram();
        }

        function drawSemivariogram() {
            const canvas = document.getElementById('semi-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Axes
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width - 50, canvas.height - 50);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, canvas.height - 50);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#2c3e50';
            ctx.font = '14px Arial';
            ctx.fillText('Distancia (h)', canvas.width / 2, canvas.height - 10);
            ctx.save();
            ctx.translate(15, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Semivarianza Œ≥(h)', 0, 0);
            ctx.restore();
            
            // Experimental points
            const points = [];
            for (let i = 0; i < 15; i++) {
                const x = 80 + i * 45;
                const h = i / 14;
                const y = canvas.height - 100 - (1 - Math.exp(-h * 2.5)) * 180 + (Math.random() - 0.5) * 15;
                points.push({x, y});
                
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Fitted model
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(80, canvas.height - 100);
            for (let i = 0; i < 100; i++) {
                const x = 80 + i * 6.5;
                const h = i / 99;
                const y = canvas.height - 100 - (1 - Math.exp(-h * 2.5)) * 180;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function showModelFitting(vizArea) {
            vizArea.innerHTML = `
                <h3>üî¨ Ajuste de Modelo Geoestad√≠stico</h3>
                <div class="chart-container">
                    <canvas id="model-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">Gaussiano</div>
                        <div class="stat-label">Modelo √ìptimo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.93</div>
                        <div class="stat-label">Bondad Ajuste</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1250m</div>
                        <div class="stat-label">Rango</div>
                    </div>
                </div>
            `;
            drawModelFit();
        }

        function drawModelFit() {
            const canvas = document.getElementById('model-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const models = [
                {name: 'Esf√©rico', color: '#e74c3c'},
                {name: 'Exponencial', color: '#3498db'},
                {name: 'Gaussiano', color: '#2ecc71'}
            ];
            
            models.forEach((model, idx) => {
                ctx.strokeStyle = model.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let x = 50; x < canvas.width - 50; x += 5) {
                    const h = (x - 50) / (canvas.width - 100);
                    let y;
                    
                    if (idx === 0) {
                        y = canvas.height - 100 - (1.5 * h - 0.5 * Math.pow(h, 3)) * 150;
                    } else if (idx === 1) {
                        y = canvas.height - 100 - (1 - Math.exp(-3 * h)) * 150;
                    } else {
                        y = canvas.height - 100 - (1 - Math.exp(-3 * h * h)) * 150;
                    }
                    
                    if (x === 50) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
                
                // Legend
                ctx.fillStyle = model.color;
                ctx.fillRect(canvas.width - 150, 70 + idx * 30, 20, 10);
                ctx.fillStyle = '#2c3e50';
                ctx.font = '14px Arial';
                ctx.fillText(model.name, canvas.width - 120, 80 + idx * 30);
            });
        }

        function showPrediction(vizArea) {
            vizArea.innerHTML = `
                <h3>üéØ Predicci√≥n Espacial</h3>
                <div class="map-container">
                    <canvas id="prediction-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">2500</div>
                        <div class="stat-label">Puntos Predichos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">¬± 3.2</div>
                        <div class="stat-label">Error Est√°ndar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">95%</div>
                        <div class="stat-label">IC</div>
                    </div>
                </div>
            `;
            drawPrediction();
        }

        function drawPrediction() {
            const canvas = document.getElementById('prediction-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Prediction surface
            for (let y = 0; y < canvas.height; y += 4) {
                for (let x = 0; x < canvas.width; x += 4) {
                    const value = (Math.sin(x * 0.02) + Math.cos(y * 0.015)) / 2 + 0.5;
                    const hue = 200 + value * 80;
                    ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
                    ctx.fillRect(x, y, 4, 4);
                }
            }
            
            // Sample points
            for (let i = 0; i < 30; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                
                ctx.fillStyle = 'white';
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            }
        }

        function showIDW(vizArea) {
            vizArea.innerHTML = `
                <h3>üìç Interpolaci√≥n IDW (Inverse Distance Weighting)</h3>
                <div class="map-container">
                    <canvas id="idw-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">2</div>
                        <div class="stat-label">Potencia</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Vecinos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.88</div>
                        <div class="stat-label">R¬≤</div>
                    </div>
                </div>
            `;
            drawIDW();
        }

        function drawIDW() {
            const canvas = document.getElementById('idw-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Sample points
            const samples = [];
            for (let i = 0; i < 15; i++) {
                samples.push({
                    x: 50 + Math.random() * 700,
                    y: 50 + Math.random() * 400,
                    value: Math.random()
                });
            }
            
            // IDW interpolation
            for (let y = 0; y < canvas.height; y += 3) {
                for (let x = 0; x < canvas.width; x += 3) {
                    let weightSum = 0;
                    let valueSum = 0;
                    
                    samples.forEach(s => {
                        const dist = Math.sqrt(Math.pow(x - s.x, 2) + Math.pow(y - s.y, 2)) + 0.1;
                        const weight = 1 / (dist * dist);
                        weightSum += weight;
                        valueSum += weight * s.value;
                    });
                    
                    const value = valueSum / weightSum;
                    const r = Math.floor(255 * (1 - value));
                    const g = Math.floor(100 + 155 * value);
                    const b = Math.floor(100);
                    
                    ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                    ctx.fillRect(x, y, 3, 3);
                }
            }
            
            // Draw sample points
            samples.forEach(s => {
                ctx.fillStyle = 'white';
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(s.x, s.y, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            });
        }

        function showOrdinaryKriging(vizArea) {
            vizArea.innerHTML = `
                <h3>üéØ Kriging Ordinario</h3>
                <div class="map-container">
                    <canvas id="ok-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">Esf√©rico</div>
                        <div class="stat-label">Variograma</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.92</div>
                        <div class="stat-label">R¬≤ CV</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">800m</div>
                        <div class="stat-label">Rango</div>
                    </div>
                </div>
            `;
            drawOrdinaryKriging();
        }

        function drawOrdinaryKriging() {
            const canvas = document.getElementById('ok-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Smooth interpolation
            for (let y = 0; y < canvas.height; y += 2) {
                for (let x = 0; x < canvas.width; x += 2) {
                    const value = (Math.sin(x * 0.012) * Math.cos(y * 0.015) + 1) / 2;
                    const hue = 180 + value * 60;
                    ctx.fillStyle = `hsl(${hue}, 80%, ${40 + value * 30}%)`;
                    ctx.fillRect(x, y, 2, 2);
                }
            }
            
            // Add variance overlay
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.lineWidth = 1;
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                for (let x = 0; x < canvas.width; x += 10) {
                    const y = 250 + Math.sin(x * 0.015 + i * 0.5) * 80;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }

        function showUniversalKriging(vizArea) {
            vizArea.innerHTML = `
                <h3>üåê Kriging Universal</h3>
                <div class="map-container">
                    <canvas id="uk-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">Lineal</div>
                        <div class="stat-label">Tendencia</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.94</div>
                        <div class="stat-label">R¬≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.1</div>
                        <div class="stat-label">RMSE</div>
                    </div>
                </div>
            `;
            drawUniversalKriging();
        }

        function drawUniversalKriging() {
            const canvas = document.getElementById('uk-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Trend + residuals
            for (let y = 0; y < canvas.height; y += 3) {
                for (let x = 0; x < canvas.width; x += 3) {
                    const trend = x / canvas.width;
                    const residual = (Math.sin(x * 0.03) * Math.cos(y * 0.02)) * 0.2;
                    const value = trend + residual;
                    
                    const r = Math.floor(255 * (1 - value));
                    const g = Math.floor(150 + 105 * value);
                    const b = Math.floor(255 * value);
                    
                    ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                    ctx.fillRect(x, y, 3, 3);
                }
            }
        }

        function showSpline(vizArea) {
            vizArea.innerHTML = `
                <h3>„Ä∞Ô∏è Interpolaci√≥n Spline</h3>
                <div class="map-container">
                    <canvas id="spline-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">Tensi√≥n</div>
                        <div class="stat-label">Tipo Spline</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.5</div>
                        <div class="stat-label">Par√°metro</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">Suave</div>
                        <div class="stat-label">Resultado</div>
                    </div>
                </div>
            `;
            drawSpline();
        }

        function drawSpline() {
            const canvas = document.getElementById('spline-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Smooth spline surface
            for (let y = 0; y < canvas.height; y += 2) {
                for (let x = 0; x < canvas.width; x += 2) {
                    const nx = x / canvas.width;
                    const ny = y / canvas.height;
                    const value = (Math.sin(nx * Math.PI * 2) * Math.cos(ny * Math.PI * 2) + 1) / 2;
                    
                    ctx.fillStyle = `hsl(${120 + value * 180}, 70%, ${30 + value * 50}%)`;
                    ctx.fillRect(x, y, 2, 2);
                }
            }
            
            // Control points
            const points = [
                {x: 100, y: 100}, {x: 300, y: 150}, {x: 500, y: 120},
                {x: 200, y: 300}, {x: 400, y: 350}, {x: 600, y: 280}
            ];
            
            points.forEach(p => {
                ctx.fillStyle = '#fff';
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 7, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            });
        }

        function showRExecution(vizArea) {
            vizArea.innerHTML = `
                <h3>üìò Ejecuci√≥n de Scripts R</h3>
                <div style="background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 10px; font-family: monospace; margin-top: 20px;">
                    <div style="color: #2ecc71;">R version 4.3.1 (2023-06-16)</div>
                    <div style="margin-top: 10px;">> library(sp)</div>
                    <div>> library(gstat)</div>
                    <div>> library(rgdal)</div>
                    <div style="margin-top: 10px; color: #3498db;">Cargando paquetes espaciales...</div>
                    <div style="color: #2ecc71;">‚úì Paquetes cargados exitosamente</div>
                    <div style="margin-top: 10px;">> datos <- read.csv("datos_espaciales.csv")</div>
                    <div>> summary(datos)</div>
                    <div style="margin-top: 10px; color: #e67e22;">An√°lisis completado. Ver resultados...</div>
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value">Success</div>
                        <div class="stat-label">Estado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.3s</div>
                        <div class="stat-label">Tiempo Ejecuci√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Gr√°ficos Generados</div>
                    </div>
                </div>
            `;
        }

        function showPythonExecution(vizArea) {
            vizArea.innerHTML = `
                <h3>üêç Ejecuci√≥n de Scripts Python</h3>
                <div style="background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 10px; font-family: 'Courier New', monospace; margin-top: 20px;">
                    <div style="color: #4ec9b0;">Python 3.11.4</div>
                    <div style="margin-top: 10px;">>> <span style="color: #c586c0;">import</span> geopandas <span style="color: #c586c0;">as</span> gpd</div>
                    <div>>> <span style="color: #c586c0;">import</span> numpy <span style="color: #c586c0;">as</span> np</div>
                    <div>>> <span style="color: #c586c0;">import</span> matplotlib.pyplot <span style="color: #c586c0;">as</span> plt</div>
                    <div style="margin-top: 10px;">>> gdf = gpd.read_file(<span style="color: #ce9178;">"datos.shp"</span>)</div>
                    <div>>> <span style="color: #dcdcaa;">print</span>(gdf.head())</div>
                    <div style="margin-top: 10px; color: #4ec9b0;">Procesando datos espaciales...</div>
                    <div style="color: #4ec9b0;">‚úì An√°lisis completado</div>
                </div>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value">Success</div>
                        <div class="stat-label">Estado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1.8s</div>
                        <div class="stat-label">Tiempo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Visualizaciones</div>
                    </div>
                </div>
            `;
        }

        function showQGISExport(vizArea) {
            vizArea.innerHTML = `
                <h3>üó∫Ô∏è Exportar a QGIS</h3>
                <div style="background: #f8f9fa; padding: 30px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">Formatos disponibles para exportaci√≥n:</h4>
                    <div style="display: gri">Agrupado</div>
                        <div class="stat-label">Tipo de Patr√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.023</div>
                        <div class="stat-label">p-valor</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.45</div>
                        <div class="stat-label">Estad√≠stico Z</div>
                    </div>
                </div>
            `;
            
            drawPatternChart();
        }

        function drawPatternChart() {
            const canvas = document.getElementById('pattern-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw bars
            const data = [65, 45, 80, 55, 70, 60, 75, 50];
            const barWidth = 80;
            const gap = 20;
            const maxHeight = 300;
            
            data.forEach((value, i) => {
                const height = (value / 100) * maxHeight;
                const x = i * (barWidth + gap) + 50;
                const y = canvas.height - height - 30;
                
                const gradient = ctx.createLinearGradient(0, y, 0, y + height);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, height);
                
                ctx.fillStyle = '#2c3e50';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(value, x + barWidth / 2, y - 5);
            });
        }

        function showClusterAnalysis(vizArea) {
            vizArea.innerHTML = `
                <h3>‚ö° An√°lisis de Clusters Espaciales</h3>
                <div class="map-container">
                    <canvas id="cluster-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Clusters Detectados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">89%</div>
                        <div class="stat-label">Confianza</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12.3</div>
                        <div class="stat-label">Puntos/Cluster</div>
                    </div>
                </div>
            `;
            
            drawClusters();
        }

        function drawClusters() {
            const canvas = document.getElementById('cluster-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ecf0f1';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const clusters = [
                { x: 200, y: 150, color: '#e74c3c', points: 15 },
                { x: 500, y: 200, color: '#3498db', points: 12 },
                { x: 350, y: 350, color: '#2ecc71', points: 18 },
                { x: 650, y: 300, color: '#f39c12', points: 10 },
                { x: 150, y: 400, color: '#9b59b6', points: 8 }
            ];
            
            clusters.forEach(cluster => {
                // Draw cluster area
                ctx.fillStyle = cluster.color + '20';
                ctx.beginPath();
                ctx.arc(cluster.x, cluster.y, 80, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw center
                ctx.fillStyle = cluster.color;
                ctx.beginPath();
                ctx.arc(cluster.x, cluster.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw points
                for (let i = 0; i < cluster.points; i++) {
                    const angle = (Math.PI * 2 * i) / cluster.points;
                    const radius = 30 + Math.random() * 40;
                    const px = cluster.x + Math.cos(angle) * radius;
                    const py = cluster.y + Math.sin(angle) * radius;
                    
                    ctx.fillStyle = cluster.color + 'aa';
                    ctx.beginPath();
                    ctx.arc(px, py, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }

        function showAutocorrelation(vizArea) {
            vizArea.innerHTML = `
                <h3>üìä Autocorrelaci√≥n Espacial (Moran's I)</h3>
                <div class="chart-container">
                    <canvas id="moran-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">0.645</div>
                        <div class="stat-label">Moran's I</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">0.001</div>
                        <div class="stat-label">p-valor</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">Positiva</div>
                        <div class="stat-label">Autocorrelaci√≥n</div>
                    </div>
                </div>
            `;
            
            drawMoranScatter();
        }

        function drawMoranScatter() {
            const canvas = document.getElementById('moran-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Axes
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width - 50, canvas.height - 50);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, canvas.height - 50);
            ctx.stroke();
            
            // Scatter points
            for (let i = 0; i < 100; i++) {
                const x = 100 + Math.random() * 600;
                const y = 100 + Math.random() * 200 + (x - 400) * 0.3;
                
                ctx.fillStyle = '#667eea80';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Trend line
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(100, 280);
            ctx.lineTo(700, 120);
            ctx.stroke();
        }

        function showVariogram(vizArea) {
            vizArea.innerHTML = `
                <h3>üìâ An√°lisis de Variograma</h3>
                <div class="chart-container">
                    <canvas id="variogram-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">45.2</div>
                        <div class="stat-label">Nugget</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">120.5</div>
                        <div class="stat-label">Sill</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">850 m</div>
                        <div class="stat-label">Range</div>
                    </div>
                </div>
            `;
            
            drawVariogram();
        }

        function drawVariogram() {
            const canvas = document.getElementById('variogram-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Axes
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width - 50, canvas.height - 50);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, canvas.height - 50);
            ctx.stroke();
            
            // Variogram curve
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 100);
            
            for (let x = 50; x < canvas.width - 50; x += 10) {
                const progress = (x - 50) / (canvas.width - 100);
                const y = canvas.height - 100 - (1 - Math.exp(-progress * 3)) * 150;
                ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Sample points
            for (let i = 0; i < 20; i++) {
                const x = 50 + (canvas.width - 100) * (i / 19);
                const progress = i / 19;
                const y = canvas.height - 100 - (1 - Math.exp(-progress * 3)) * 150 + (Math.random() - 0.5) * 20;
                
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function showKriging(vizArea) {
            vizArea.innerHTML = `
                <h3>üéØ Interpolaci√≥n por Kriging</h3>
                <div class="map-container">
                    <canvas id="kriging-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">0.92</div>
                        <div class="stat-label">R¬≤ Validaci√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.34</div>
                        <div class="stat-label">RMSE</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">50x50</div>
                        <div class="stat-label">Resoluci√≥n</div>
                    </div>
                </div>
            `;
            
            drawKrigingMap();
        }

        function drawKrigingMap() {
            const canvas = document.getElementById('kriging-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Create heatmap
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    const idx = (y * canvas.width + x) * 4;
                    const value = Math.sin(x * 0.01) * Math.cos(y * 0.01) * 0.5 + 0.5;
                    
                    imageData.data[idx] = 50 + value * 200;
                    imageData.data[idx + 1] = 100 + value * 100;
                    imageData.data[idx + 2] = 200;
                    imageData.data[idx + 3] = 200;
                }
            }
            ctx.putImageData(imageData, 0, 0);
            
            // Add contour lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            for (let level = 0; level < 5; level++) {
                ctx.beginPath();
                for (let x = 0; x < canvas.width; x += 5) {
                    const y = 250 + Math.sin(x * 0.02 + level * Math.PI / 2.5) * 100;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }

        function showTemporalAnalysis(vizArea) {
            vizArea.innerHTML = `
                <h3>‚è±Ô∏è An√°lisis Temporal Espacial</h3>
                <div class="chart-container">
                    <canvas id="temporal-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Per√≠odos Analizados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">+15%</div>
                        <div class="stat-label">Tendencia</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">Alta</div>
                        <div class="stat-label">Variabilidad</div>
                    </div>
                </div>
            `;
            
            drawTemporalChart();
        }

        function drawTemporalChart() {
            const canvas = document.getElementById('temporal-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Multiple time series
            const series = [
                { color: '#e74c3c', data: [] },
                { color: '#3498db', data: [] },
                { color: '#2ecc71', data: [] }
            ];
            
            // Generate data
            for (let i = 0; i < 12; i++) {
                series.forEach(s => {
                    s.data.push(150 + Math.random() * 100 + i * 5);
                });
            }
            
            // Draw series
            series.forEach(s => {
                ctx.strokeStyle = s.color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                s.data.forEach((value, i) => {
                    const x = 50 + (canvas.width - 100) * i / 11;
                    const y = canvas.height - 50 - (value - 100) * 1.5;
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();
            });
        }

        function showValidation(vizArea) {
            vizArea.innerHTML = `
                <h3>‚úì Validaci√≥n Cruzada del Modelo</h3>
                <div class="chart-container">
                    <canvas id="validation-chart" width="800" height="350"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">0.89</div>
                        <div class="stat-label">Precisi√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3.21</div>
                        <div class="stat-label">Error Medio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">Bueno</div>
                        <div class="stat-label">Ajuste</div>
                    </div>
                </div>
            `;
            
            drawValidationPlot();
        }

        function drawValidationPlot() {
            const canvas = document.getElementById('validation-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 1:1 line
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width - 50, 50);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Scatter points (observed vs predicted)
            for (let i = 0; i < 80; i++) {
                const x = 100 + Math.random() * 600;
                const y = x + (Math.random() - 0.5) * 100;
                
                ctx.fillStyle = '#667eea80';
                ctx.beginPath();
                ctx.arc(x, canvas.height - (y - 50), 6, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Additional visualization functions
        function showHotspotAnalysis(vizArea) {
            vizArea.innerHTML = `
                <h3>üî• An√°lisis de Hot Spots (Getis-Ord Gi*)</h3>
                <div class="map-container">
                    <canvas id="hotspot-canvas" width="800" height="500"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value
